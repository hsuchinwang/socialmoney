function loadCurrency(){var e=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:e},function(e){console.log(e);var o=[],t=[];o=e.split(/\d+/),o.pop(),t=e.split(/\D+/),t.shift(),console.log(o,t);for(var n="",l=0;l<o.length;l++)n+='<option value="'+t[l]*Math.pow(l+1,5)+'">'+o[l]+" 幣, 餘 "+t[l]+" 元</option>";n+='<option value="clean">全部清除</option>',$("#selectlist").html(n)})}function getSelection(e){var o=$("#selectlist option:selected"),t=[],n=[],l=[];$(o).each(function(e,o){null!=indexOfElement&&$(this).index()==indexOfElement?(t.push($(this).html().substring(0,$(this).html().indexOf(" "))),n.push(topay)):(t.push($(this).html().substring(0,$(this).html().indexOf(" "))),n.push($(this).val()/Math.pow($(this).index()+1,5)))}),console.log(n),e>total&&(t.push($("#name").html().toString()),n.push(e-total));for(var c=0;c<t.length;c++)l.push(t[c]+"幣"+n[c]+"元");return l}function create(){var e=document.getElementById("price").value,o=getSelection(e),t="<h4>我用</h4>";if(console.log(o),null!=e&&o.length>0){var n=$("#name").html().toString()+","+o.join(".")+","+e;console.log(n);var l,c,i,r,a,s;l=Math.floor(10*Math.random()+1),c=Math.floor(10*Math.random()+1),i=Math.floor(10*Math.random()+1),r=Math.floor(10*Math.random()+1),a=Math.floor(10*Math.random()+1),s=(l+c)*i*r*a,$("#pincode").html(s);for(var p=0;p<o.length;p++)t+="<h5>"+o[p]+"</h5>";t+="<h5>共"+e+"元</h5>",t+="<h4>做抵押. 請查收</h4>",document.getElementById("comfirmList").innerHTML=t,$.post("https://socialmoney.herokuapp.com/pincode",{currency:n,pin:s},function(e){console.log(e)}),$("#myModal").modal("show")}else alert("Please input the price and currency correctly!")}function removeImg(){document.getElementById("price").value="",$("option",$("#selectlist")).each(function(e){$(this).removeAttr("selected").prop("selected",!1),console.log(e)}),$("#selectlist").multiselect("refresh"),$("#pincode").html(""),total=0,topay=0}function checkPin(){var e=document.getElementById("userpin").value,o="";console.log(e),$.post("https://socialmoney.herokuapp.com/checkpin",{pin:e},function(e){console.log(e),"fail"!=e.toString()?(o=e.toString(),console.log(o),updateDB(o),alert("The record is saved!")):alert("The Pin Code is wrong! Please input the correct one!")}),""!=o&&(console.log(o),updateDB(o)),document.getElementById("userpin").value=""}function updateDB(e){e=e.replace(/幣/g,""),e=e.replace(/元/g,""),e=e.replace(/\./g,"");var o=e.split(","),t=o[2],n=o[0],l=o[1].split(/\D+/),c=o[1].split(/\d+/),i=$("#name").html().toString();l.shift(),c.pop(),console.log(o,t,n,c,l,i),$.post("https://socialmoney.herokuapp.com/minus",{name:n,currency:c,price:l},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/add",{name:i,currency:c,price:l},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/keeprecord",{namec:i,named:n,price:t,currency:o[1].toString()},function(e){console.log(e)}),loadCurrency()}var topay=0,total=0,indexOfElement=null;$("#tabRecord a").click(function(e){loadCurrency()});