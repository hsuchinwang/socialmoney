function loadCurrency(){var e=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:e},function(e){console.log(e);var t=[],l=[];t=e.split(/\d+/),t.pop(),l=e.split(/\D+/),l.shift(),console.log(t,l);for(var o="",n=0;n<t.length;n++)o+='<option value="'+l[n]*Math.pow(n+1,5)+'">'+t[n]+" 幣, 餘 "+l[n]+" 元</option>";o+='<option value="clean">全部清除</option>',$("#selectlist").html(o),$(document).ready(function(){$("#selectlist").multiselect({buttonWidth:"100%",onChange:function(e,t){if(t===!0){if("clean"==e.val()){$("#selectlist").multiselect("deselectAll",!0),$("#selectlist").multiselect("updateButtonText"),total=0;var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")})}else if(""==$("#price").val())alert("請輸入價錢!!"),$("#selectlist").multiselect("deselect",e.val());else if(total+=parseInt(e.val()/Math.pow(e.index()+1,5)),total>parseInt($("#price").val())){indexOfElement=e.index(),console.log(indexOfElement),topay=parseInt(e.val()/Math.pow(e.index()+1,5))-(total-parseInt($("#price").val())),total=parseInt($("#price").val());var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");l.each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!0),e.parent("li").addClass("disabled")});var o=$('input[value="clean"]');o.prop("disabled",!1),o.parent("li").addClass("disabled")}}else if(t===!1){total=0,topay=0;var n=$("#selectlist option:selected"),i=[];$(n).each(function(e,t){i.push($(this).val()/Math.pow($(this).index()+1,5))}),console.log(i);for(var s=0;s<i.length;s++)total+=parseInt(i[s]);var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")})}},buttonText:function(e,t){return console.log(e),console.log(t),0===e.length?"Select currency  ":e.length>=1?"$ "+total+" will pay":void 0}})})})}function getSelection(e){var t=$("#selectlist option:selected"),l=[],o=[],n=[];$(t).each(function(e,t){null!=indexOfElement&&$(this).index()==indexOfElement?(l.push($(this).html().substring(0,$(this).html().indexOf(" "))),o.push(topay)):(l.push($(this).html().substring(0,$(this).html().indexOf(" "))),o.push($(this).val()/Math.pow($(this).index()+1,5)))}),console.log(o),e>total&&(l.push($("#name").html().toString()),o.push(e-total));for(var i=0;i<l.length;i++)n.push(l[i]+"幣"+o[i]+"元");return n}function create(){var e=document.getElementById("price").value,t=getSelection(e),l="<h4>我用</h4>";if(console.log(t),null!=e&&t.length>0){var o=$("#name").html().toString()+","+t.join(".")+","+e;console.log(o);var n,i,s,a,c,r;n=Math.floor(10*Math.random()+1),i=Math.floor(10*Math.random()+1),s=Math.floor(10*Math.random()+1),a=Math.floor(10*Math.random()+1),c=Math.floor(10*Math.random()+1),r=(n+i)*s*a*c,$("#pincode").html(r);for(var p=0;p<t.length;p++)l+="<h5>"+t[p]+"</h5>";l+="<h5>共"+e+"元</h5>",l+="<h4>做抵押. 請查收</h4>",document.getElementById("comfirmList").innerHTML=l,$.post("https://socialmoney.herokuapp.com/pincode",{currency:o,pin:r},function(e){console.log(e)}),$("#myModal").modal("show")}else alert("Please input the price and currency correctly!")}function removeImg(){document.getElementById("price").value="",$("option",$("#selectlist")).each(function(e){$(this).removeAttr("selected").prop("selected",!1),console.log(e)}),$("#selectlist").multiselect("refresh"),$("#pincode").html(""),total=0,topay=0}function checkPin(){var e=document.getElementById("userpin").value,t="";console.log(e),$.post("https://socialmoney.herokuapp.com/checkpin",{pin:e},function(e){console.log(e),"fail"!=e.toString()?(t=e.toString(),console.log(t),updateDB(t),alert("The record is saved!")):alert("The Pin Code is wrong! Please input the correct one!")}),""!=t&&(console.log(t),updateDB(t)),document.getElementById("userpin").value=""}function updateDB(e){e=e.replace(/幣/g,""),e=e.replace(/元/g,""),e=e.replace(/\./g,"");var t=e.split(","),l=t[2],o=t[0],n=t[1].split(/\D+/),i=t[1].split(/\d+/),s=$("#name").html().toString();n.shift(),i.pop(),console.log(t,l,o,i,n,s),$.post("https://socialmoney.herokuapp.com/minus",{name:o,currency:i,price:n},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/add",{name:s,currency:i,price:n},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/keeprecord",{namec:s,named:o,price:l,currency:t[1].toString()},function(e){console.log(e)}),loadCurrency()}var topay=0,total=0,indexOfElement=null;$("#tabRecord a").click(function(e){loadCurrency()});