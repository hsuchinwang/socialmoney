var topay=0,total=0,indexOfElement=null;$("#tabRecord a").click(function(a){loadCurrency()});
function loadCurrency(){var a=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:a},function(a){console.log(a);var c=[],b=[],c=a.split(/\d+/);c.pop();b=a.split(/\D+/);b.shift();console.log(c,b);a="";for(var d=0;d<c.length;d++)a+='<option value="'+b[d]*Math.pow(d+1,5)+'">'+c[d]+" \u5e63, \u9918 "+b[d]+" \u5143</option>";a+='<option value="clean">\u5168\u90e8\u6e05\u9664</option>';$("#selectlist").html(a);$(document).ready(function(){$("#selectlist").multiselect({buttonWidth:"100%",
onChange:function(a,c){if(!0===c)if("clean"==a.val()){$("#selectlist").multiselect("deselectAll",!0);$("#selectlist").multiselect("updateButtonText");total=0;var b=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var a=$('input[value="'+$(this).val()+'"]');a.prop("disabled",!1);a.parent("li").addClass("disabled")})}else""==$("#price").val()?(alert("\u8acb\u8f38\u5165\u50f9\u9322!!"),
$("#selectlist").multiselect("deselect",a.val())):(total+=parseInt(a.val()/Math.pow(a.index()+1,5)),total>parseInt($("#price").val())&&(indexOfElement=a.index(),console.log(indexOfElement),topay=parseInt(a.val()/Math.pow(a.index()+1,5))-(total-parseInt($("#price").val())),total=parseInt($("#price").val()),b=$("#selectlist option").filter(function(){return!$(this).is(":selected")}),$("#selectlist").siblings(".multiselect-container"),b.each(function(){var a=$('input[value="'+$(this).val()+'"]');a.prop("disabled",
!0);a.parent("li").addClass("disabled")}),b=$('input[value="clean"]'),b.prop("disabled",!1),b.parent("li").addClass("disabled")));else if(!1===c){topay=total=0;var b=$("#selectlist option:selected"),d=[];$(b).each(function(a,b){d.push($(this).val()/Math.pow($(this).index()+1,5))});console.log(d);for(b=0;b<d.length;b++)total+=parseInt(d[b]);b=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var a=
$('input[value="'+$(this).val()+'"]');a.prop("disabled",!1);a.parent("li").addClass("disabled")})}},buttonText:function(a,b){console.log(a);console.log(b);if(0===a.length)return"Select currency  ";if(1<=a.length)return"$ "+total+" will pay"}})})})}
function getSelection(a){var e=$("#selectlist option:selected"),c=[],b=[],d=[];$(e).each(function(a,d){null!=indexOfElement&&$(this).index()==indexOfElement?(c.push($(this).html().substring(0,$(this).html().indexOf(" "))),b.push(topay)):(c.push($(this).html().substring(0,$(this).html().indexOf(" "))),b.push($(this).val()/Math.pow($(this).index()+1,5)))});console.log(b);total<a&&(c.push($("#name").html().toString()),b.push(a-total));for(a=0;a<c.length;a++)d.push(c[a]+"\u5e63"+b[a]+"\u5143");return d}
function create(){var a=document.getElementById("price").value,e=getSelection(a),c="<h4>\u6211\u7528</h4>";console.log(e);if(null!=a&&0<e.length){var b=$("#name").html().toString()+","+e.join(".")+","+a;console.log(b);var d;d=(Math.floor(10*Math.random()+1)+Math.floor(10*Math.random()+1))*Math.floor(10*Math.random()+1)*Math.floor(10*Math.random()+1)*Math.floor(10*Math.random()+1);$("#pincode").html(d);for(var f=0;f<e.length;f++)c+="<h5>"+e[f]+"</h5>";c=c+("<h5>\u5171"+a+"\u5143</h5>")+"<h4>\u505a\u62b5\u62bc. \u8acb\u67e5\u6536</h4>";
document.getElementById("comfirmList").innerHTML=c;$.post("https://socialmoney.herokuapp.com/pincode",{currency:b,pin:d},function(a){console.log(a)});$("#myModal").modal("show")}else alert("Please input the price and currency correctly!")}function removeImg(){document.getElementById("price").value="";$("option",$("#selectlist")).each(function(a){$(this).removeAttr("selected").prop("selected",!1);console.log(a)});$("#selectlist").multiselect("refresh");$("#pincode").html("");topay=total=0}
function checkPin(){var a=document.getElementById("userpin").value,e="";console.log(a);$.post("https://socialmoney.herokuapp.com/checkpin",{pin:a},function(a){console.log(a);"fail"!=a.toString()?(e=a.toString(),console.log(e),updateDB(e),alert("The record is saved!")):alert("The Pin Code is wrong! Please input the correct one!")});""!=e&&(console.log(e),updateDB(e));document.getElementById("userpin").value=""}
function updateDB(a){a=a.replace(/\u5e63/g,"");a=a.replace(/\u5143/g,"");a=a.replace(/\./g,"");a=a.split(",");var e=a[2],c=a[0],b=a[1].split(/\D+/),d=a[1].split(/\d+/),f=$("#name").html().toString();b.shift();d.pop();console.log(a,e,c,d,b,f);$.post("https://socialmoney.herokuapp.com/minus",{name:c,currency:d,price:b},function(a){console.log(a)});$.post("https://socialmoney.herokuapp.com/add",{name:f,currency:d,price:b},function(a){console.log(a)});$.post("https://socialmoney.herokuapp.com/keeprecord",
{namec:f,named:c,price:e,currency:a[1].toString()},function(a){console.log(a)})};