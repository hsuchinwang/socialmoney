function loadUser(){$.get("https://socialmoney.herokuapp.com/find_user",function(e){var t=e.split("|");t.pop();for(var l="",n=0;n<t.length;n++){var o=t[n].substring(0,t[n].indexOf("%")),i=t[n].substring(t[n].indexOf("%")+1,t[n].length);l+="<option value='"+o+"' style='background-image:url('"+i+"');'>"+o+"</option>"}$("#selectuser").html(l),$("#selectlist").multiselect("rebuild")})}function loadCurrency(){var e=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:e},function(e){var t=e.split(".");t.pop();for(var l=[],n=[],o=[],i=0;i<t.length;i+=3)l.push(t[i]),n.push(t[i+1]),o.push(t[i+2]);for(var s="",i=0;i<l.length;i++)s+='<option value="'+o[i]*Math.pow(i+1,5)+'">'+l[i]+" 幣, 餘 "+n[i]+"("+o[i]+") 元</option>";s+='<option value="clean">全部清除</option>',$("#selectlist").append(s),$("#selectlist").multiselect("rebuild");var a=$('input[value="0"]');a.prop("disabled",!0),a.parent("li").addClass("disabled")})}function getSelection(e){var t=$("#selectlist option:selected"),l=[],n=[],o=[],i=$("#name").html().toString();$(t).each(function(e,t){null!=indexOfElement&&$(this).index()==indexOfElement?(l.push($(this).html().substring(0,$(this).html().indexOf("幣")-1)),n.push(topay)):(l.push($(this).html().substring(0,$(this).html().indexOf("幣")-1)),n.push($(this).val()/Math.pow($(this).index()+1,5)))}),e>total&&(l.push($("#name").html().toString()),n.push(e-total));for(var s=0;s<l.length;s++)o.push(l[s]+"幣"+n[s]+"元");return $.post("https://socialmoney.herokuapp.com/minusAvailable",{name:i,currency:l,price:n},function(e){console.log(e)}),o}function create(){var e=document.getElementById("price").value,t=getSelection(e),l="<h4>我用</h4>",n=$("#selectuser option:selected");if(null!=e&&t.length>0&&n.length>0){var o=$("#name").html().toString()+","+t.join(".")+","+e;console.log(o);var i,s,a,c,r,u;i=Math.floor(10*Math.random()+1),s=Math.floor(10*Math.random()+1),a=Math.floor(10*Math.random()+1),c=Math.floor(10*Math.random()+1),r=Math.floor(10*Math.random()+1),u=(i+s)*a*c*r,$("#pincode").html(u);for(var p=0;p<t.length;p++)l+="<h5>"+t[p]+"</h5>";l+="<h5>共"+e+"元</h5>",l+="<h4>做抵押. 請查收</h4>",document.getElementById("comfirmList").innerHTML=l,$.post("https://socialmoney.herokuapp.com/pincode",{currency:o,pin:u,create:n.html()},function(e){console.log(e)}),$("#myModal").modal("show")}else alert("Please input the price, currency and user correctly!")}function removeImg(){document.getElementById("price").value="",$("#selectlist").multiselect("deselectAll",!1),$("#selectlist").multiselect("updateButtonText"),$("#selectuser").multiselect("deselectAll",!1),$("#selectuser").multiselect("updateButtonText"),$("#pincode").html(""),$("#selectlist").html(""),loadCurrency(),total=0,topay=0}function checkPin(){var e=document.getElementById("userpin").value,t="",l=$("#name").html().toString();""==e?alert("Please input the correct Pin Code."):$.post("https://socialmoney.herokuapp.com/checkpin",{pin:e,name:l},function(e){console.log(e),"fail"!=e.toString()?(t=e.toString(),updateDB(t)):alert("The Pin Code is wrong or it is not for you! Please input the correct one!")}),document.getElementById("userpin").value=""}function updateDB(e){var t=$("#name").html().toString(),l="";e=e.replace(/幣/g,""),e=e.replace(/元/g,""),e=e.replace(/\./g,"");var n=e.split(","),o=n[2],i=n[0],s=n[1].split(/\D+/),a=n[1].split(/\d+/);s.shift(),a.pop(),l+="<h4>您得到：</h4>";for(var c=0;c<a.length;c++)l+="<h5>"+a[c]+" 幣, "+s[c]+"元</h5>";l+="<h5>共"+o+"元</h5>",document.getElementById("checkList").innerHTML=l,$("#mycomfirmModal").modal("show"),$.post("https://socialmoney.herokuapp.com/minus",{name:i,currency:a,price:s},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/add",{name:t,currency:a,price:s},function(e){console.log(e)}),$.post("https://socialmoney.herokuapp.com/keeprecord",{namec:t,named:i,price:o,currency:n[1].toString()},function(e){console.log(e)})}var topay=0,total=0,indexOfElement=null;$("#tabBar").on("click","li",function(e){"#tabRecord"==$(this).find("a").attr("href")&&($("#selectlist").html(""),loadCurrency())}),$(document).ready(function(){var e="";$("#selectuser").multiselect({enableCaseInsensitiveFiltering:!0,buttonWidth:"100%",buttonText:function(e,t){return 0===e.length?"Select user ":t.val()},onChange:function(t,l){l===!0?($("#selectuser").multiselect("deselect",e),e=$("#selectuser option:selected").val()):l===!1&&(e="")}}),$("#selectlist").multiselect({buttonWidth:"100%",onChange:function(e,t){if(t===!0){if("clean"==e.val()){$("#selectlist").multiselect("deselectAll",!0),$("#selectlist").multiselect("updateButtonText"),total=0;var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")})}else if(""==$("#price").val())alert("請輸入價錢!!"),$("#selectlist").multiselect("deselect",e.val());else if(total+=parseInt(e.val()/Math.pow(e.index()+1,5)),total>parseInt($("#price").val())){indexOfElement=e.index(),console.log(indexOfElement),topay=parseInt(e.val()/Math.pow(e.index()+1,5))-(total-parseInt($("#price").val())),total=parseInt($("#price").val());var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");l.each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!0),e.parent("li").addClass("disabled")});var n=$('input[value="clean"]');n.prop("disabled",!1),n.parent("li").addClass("disabled")}}else if(t===!1){total=0,topay=0;var o=$("#selectlist option:selected"),i=[];$(o).each(function(e,t){i.push($(this).val()/Math.pow($(this).index()+1,5))});for(var s=0;s<i.length;s++)total+=parseInt(i[s]);var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var e=$('input[value="'+$(this).val()+'"]');e.prop("disabled",!1),e.parent("li").addClass("disabled")})}},buttonText:function(e,t){return 0===e.length?"Select currency  ":e.length>=1?"$ "+total+" will pay":void 0}})});