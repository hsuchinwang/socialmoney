function loadUser(){$("#selectuser").html(""),$("#friendlist").html("");var t=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_friend",{name:t},function(e){var l=e.split(".");l.pop();for(var o="<optgroup label='Friends:' class='group-1'>",n=0;n<l.length;n++)o+="<option value='"+l[n]+"'>"+l[n]+"</option>";o+="</optgroup>",$("#selectuser").append(o),$("#friendlist").append(o),$("#selectuser").multiselect("rebuild"),$("#friendlist").multiselect("rebuild"),$.get("https://socialmoney.herokuapp.com/find_user",function(e){var l=e.split("|");l.pop();for(var o="<optgroup label='All users:' class='group-2'>",n=0;n<l.length;n++){var i=l[n].substring(0,l[n].indexOf("%"));o+="<option value='"+i+"'>"+i+"</option>"}o+="</optgroup>",$("#selectuser").append(o),$("#selectuser").multiselect("rebuild"),$("#friendlist").append(o),$("#friendlist").multiselect("rebuild");var a=$('input[value="'+t+'"]');a.prop("disabled",!0),a.parent("li").addClass("disabled")})})}function loadCurrency(){var t=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:t},function(t){var e=t.split(".");e.pop();for(var l="",o=0,n=0;n<e.length;n+=3)0==n&&(availableAmount=e[n+2]),l+='<option value="'+e[n+2]*Math.pow(o+1,5)+'">'+e[n]+" 幣, 餘 "+e[n+1]+"("+e[n+2]+") 元</option>",o++;l+='<option value="clean">全部清除</option>',$("#selectlist").append(l),$("#selectlist").multiselect("rebuild");var i=$('input[value="0"]');i.prop("disabled",!0),i.parent("li").addClass("disabled")})}function checkAmount(t,e){document.getElementById(e).innerHTML=t+"個",countTotal()}function countTotal(){totalprice=0,"數量"!=$("#bagle").html().toString()&&(totalprice+=25*parseInt($("#bagle").html().toString().replace(/個/g,""))),"數量"!=$("#ice").html().toString()&&(totalprice+=16*parseInt($("#ice").html().toString().replace(/個/g,""))),$("#showtotal").html("Total: "+totalprice)}function checkTotal(){var t="<h4>您購買：</h4>";"數量"!=$("#bagle").html().toString()&&(t+="<h4>貝果 "+$("#bagle").html().toString()+"</h4>"),"數量"!=$("#ice").html().toString()&&(t+="<h4>冰淇淋 "+$("#ice").html().toString()+"</h4>"),"數量"==$("#bagle").html().toString()&&"數量"==$("#ice").html().toString()&&(removeItem(),alert("請選擇商品數量！")),$("#itemDiv").html(t),$("#itemtotal").html("Total: "+totalprice+"元"),$("#myCheckModal").modal("show")}function removeItem(){$("#bagle").html("數量"),$("#ice").html("數量"),$("#showtotal").html("Total: 0元"),totalprice=0}function toStore(){var t=$("#name").html().toString(),e=t+totalprice.toString();availableAmount>totalprice?(console.log(totalprice),$.post("https://socialmoney.herokuapp.com/toStore",{name:t,price:totalprice},function(t){console.log(t)}),$.post("https://socialmoney.herokuapp.com/keeprecord",{namec:"誠實商店",named:t,price:totalprice,currency:e},function(t){console.log(t)}),alert("已結帳，謝謝惠顧！")):alert("You don't have enough money."),removeItem(),$("#myCheckModal").modal("hide")}function addFriend(t,e){$.post("https://socialmoney.herokuapp.com/addfriend",{name:t,friend:e},function(t){console.log(t)})}function getFriend(){var t=$("#friendlist option:selected"),e="",l=$("#name").html().toString();$(t).each(function(t,l){$(this).parent("optgroup").hasClass("group-2")&&(e+=$(this).val()+".")}),e=e.substring(0,e.length-1),""!=e&&(addFriend(l,e),alert("Saved!")),$("#friendlist").multiselect("deselectAll",!1),$("#friendlist").multiselect("updateButtonText"),loadUser()}function getSelection(t,e){var l=$("#selectlist option:selected"),o=[],n=[],i=[],a=$("#name").html().toString();$(l).each(function(t,e){null!=indexOfElement&&$(this).index()==indexOfElement?(o.push($(this).html().substring(0,$(this).html().indexOf("幣")-1)),n.push(topay)):(o.push($(this).html().substring(0,$(this).html().indexOf("幣")-1)),n.push($(this).val()/Math.pow($(this).index()+1,5)))}),t>total&&(o.push($("#name").html().toString()),n.push(t-total));for(var s=0;s<o.length;s++)i.push(o[s]+"幣"+n[s]+"元");return $.post("https://socialmoney.herokuapp.com/minusAvailable",{name:a,currency:o,price:n},function(t){console.log(t)}),""!=e&&(addFriend(a,e),addFriend(e,a)),i}function create(){var t=document.getElementById("price").value;if(parseInt(t)>availableAmount)return alert("You don't have enough money!"),void removeImg();var e=$("#selectuser option:selected"),l=getSelection(t,e.html().toString()),o="<h4>我用</h4>";if(null!=t&&l.length>0&&e.length>0){var n=$("#name").html().toString()+","+l.join(".")+","+t;console.log(n);var i,a,s,r,c,p;i=Math.floor(10*Math.random()+1),a=Math.floor(10*Math.random()+1),s=Math.floor(10*Math.random()+1),r=Math.floor(10*Math.random()+1),c=Math.floor(10*Math.random()+1),p=(i+a)*s*r*c,$("#pincode").html(p);for(var u=0;u<l.length;u++)o+="<h5>"+l[u]+"</h5>";o+="<h5>共"+t+"元</h5><h4>做抵押. 請查收</h4>",document.getElementById("comfirmList").innerHTML=o,$.post("https://socialmoney.herokuapp.com/pincode",{currency:n,pin:p,create:e.html()},function(t){console.log(t)}),$("#myModal").modal("show")}else alert("Please input the price, currency and user correctly!")}function removeImg(){document.getElementById("price").value="",$("#selectlist").multiselect("deselectAll",!1),$("#selectlist").multiselect("updateButtonText"),$("#selectuser").multiselect("deselectAll",!1),$("#selectuser").multiselect("updateButtonText"),$("#pincode").html(""),$("#selectlist").html(""),loadUser(),loadCurrency(),total=0,topay=0}function checkPin(){var t=document.getElementById("userpin").value,e="",l=$("#name").html().toString();""==t?alert("Please input the correct Pin Code."):$.post("https://socialmoney.herokuapp.com/checkpin",{pin:t,name:l},function(t){console.log(t),"fail"!=t.toString()?(e=t.toString(),updateDB(e)):alert("The Pin Code is wrong or it is not for you! Please input the correct one!")}),document.getElementById("userpin").value=""}function updateDB(t){var e=$("#name").html().toString(),l="";t=t.replace(/幣/g,"").replace(/元/g,"").replace(/\./g,"");var o=t.split(","),n=o[1].split(/\D+/),i=o[1].split(/\d+/);n.shift(),i.pop(),l+="<h4>您得到：</h4>";for(var a=0;a<i.length;a++)l+="<h5>"+i[a]+" 幣, "+n[a]+"元</h5>";l+="<h5>共"+o[2]+"元</h5>",document.getElementById("checkList").innerHTML=l,$("#mycomfirmModal").modal("show"),$.post("https://socialmoney.herokuapp.com/minus",{name:o[0],currency:i,price:n},function(t){console.log(t)}),$.post("https://socialmoney.herokuapp.com/add",{name:e,currency:i,price:n},function(t){console.log(t)}),$.post("https://socialmoney.herokuapp.com/keeprecord",{namec:e,named:o[0],price:o[2],currency:o[1].toString()},function(t){console.log(t)})}var topay=0,total=0,availableAmount=0,totalprice=0,indexOfElement=null;$("#tabBar").on("click","li",function(t){"#tabRecord"==$(this).find("a").attr("href")&&($("#selectlist").html(""),loadUser(),loadCurrency())}),$(document).ready(function(){var t="";$("#selectuser").multiselect({enableCaseInsensitiveFiltering:!0,buttonWidth:"100%",maxHeight:200,enableCollapsibleOptGroups:!0,buttonText:function(t,e){return 0===t.length?"Select user ":e.val()},onChange:function(e,l){l===!0?($("#selectuser").multiselect("deselect",t),t=$("#selectuser option:selected").val()):l===!1&&(t="")}}),$("#friendlist").multiselect({enableCaseInsensitiveFiltering:!0,buttonWidth:"100%",maxHeight:200,enableCollapsibleOptGroups:!0}),$("#selectlist").multiselect({buttonWidth:"100%",onChange:function(t,e){if(e===!0){if("clean"==t.val()){$("#selectlist").multiselect("deselectAll",!0),$("#selectlist").multiselect("updateButtonText"),total=0;var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var t=$('input[value="'+$(this).val()+'"]');t.prop("disabled",!1),t.parent("li").addClass("disabled")})}else if(""==$("#price").val())alert("請輸入價錢!!"),$("#selectlist").multiselect("deselect",t.val());else if(total+=parseInt(t.val()/Math.pow(t.index()+1,5)),total>parseInt($("#price").val())){indexOfElement=t.index(),console.log(indexOfElement),topay=parseInt(t.val()/Math.pow(t.index()+1,5))-(total-parseInt($("#price").val())),total=parseInt($("#price").val());var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");l.each(function(){var t=$('input[value="'+$(this).val()+'"]');t.prop("disabled",!0),t.parent("li").addClass("disabled")});var o=$('input[value="clean"]');o.prop("disabled",!1),o.parent("li").addClass("disabled")}}else if(e===!1){total=0,topay=0;var n=$("#selectlist option:selected"),i=[];$(n).each(function(t,e){i.push($(this).val()/Math.pow($(this).index()+1,5))});for(var a=0;a<i.length;a++)total+=parseInt(i[a]);var l=$("#selectlist option").filter(function(){return!$(this).is(":selected")});$("#selectlist").siblings(".multiselect-container");$("#selectlist option").each(function(){var t=$('input[value="'+$(this).val()+'"]');t.prop("disabled",!1),t.parent("li").addClass("disabled")})}},buttonText:function(t,e){return 0===t.length?"Select currency  ":t.length>=1?"$ "+total+" will pay":void 0}}),$(function(){$('[data-toggle="tooltip"]').tooltip()}),$("#walletinput").click(function(){var t=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/find_my_money",{name:t},function(t){var e=t.split(".");e.pop();for(var l="",o=0,n=0,i=0;i<e.length;i+=3)o+=parseInt(e[i+1]),l+='<li class="list-group-item"><span class="glyphicon glyphicon-check" aria-hidden="true"></span> '+e[i]+" 幣, 餘 "+e[i+1]+" ("+e[i+2]+") 元</li>";n=o-5e3,l+='<li class="list-group-item"><span class="glyphicon glyphicon-piggy-bank" aria-hidden="true"></span> 合計：'+o+" 元 ("+n+")</li>",$("#moneylist").html(l)}),$(this).attr("data-toggle","collapse")}),$("#recordinput").click(function(){var t=$("#name").html().toString();$.post("https://socialmoney.herokuapp.com/getrecord",{name:t},function(t){var e=t.split(".");e.pop();for(var l="",o=e.length-1;o>=0;o--)l+='<li class="list-group-item"><span class="glyphicon glyphicon-check" aria-hidden="true"></span> '+e[o]+"</li>";$("#moneylist").html(l)}),$(this).attr("data-toggle","collapse")})});